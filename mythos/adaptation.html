<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Adaptation - Flip & Drag (Power & Weakness)</title>
    <style>
      /* --- Layout --- */
      * {
        box-sizing: border-box;
      }
      body {
        margin: 0;
        font-family: Arial, sans-serif;
        background: #f9f9f9;
      }
      .split-container {
        display: flex;
        min-height: 100vh;
        align-items: flex-start;
      }
      .left-panel,
      .right-panel {
        padding: 20px;
        width: 50%;
        overflow-y: auto;
      }
      /* Left panel arranged horizontally */
      .left-panel {
        background: #efefef;
        display: flex;
        flex-direction: row;
        flex-wrap: wrap;
        gap: 20px;
        align-items: flex-start;
        justify-content: flex-start;
      }
      .right-panel {
        background: #fff;
        display: flex;
        justify-content: center;
        align-items: flex-start;
      }

      /* --- Flip Card (Vertical Flip) --- */
      .flip-card {
        background-color: transparent;
        width: 200px;
        height: 220px;
        perspective: 1000px;
        cursor: pointer;
      }
      .flip-card-inner {
        position: relative;
        width: 100%;
        height: 100%;
        transition: transform 0.6s ease-in-out;
        transform-style: preserve-3d;
      }
      .flip-card-front,
      .flip-card-back {
        position: absolute;
        width: 100%;
        height: 100%;
        backface-visibility: hidden;
        border-radius: 10px;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        text-align: center;
        padding: 10px;
      }
      .flip-card-front {
        background: #ccc;
        color: #333;
      }
      .flip-card-back {
        background: #fff;
        transform: rotateX(180deg);
      }
      .flipped {
        transform: rotateX(180deg);
      }

      /* --- Flip Card Content Layout (Top/Bottom) --- */
      .question-top {
        flex: 1;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: bold;
        padding: 5px;
      }
      .answer-bottom {
        flex: 1;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: flex-start;
        padding: 5px;
      }

      /* Draggable Answer Block on back side */
      .answer-block {
        margin-top: 10px;
        padding: 8px 10px;
        background: #ffd700;
        border-radius: 5px;
        cursor: grab;
        font-weight: bold;
        text-align: center;
      }

      /* --- Flip Card Front Layout --- */
      .flip-card-front .draggable-letter {
        cursor: grab;
        background-color: hotpink;
        color: white;
        padding: 5px;
        border-radius: 3px;
        display: inline-block;
        margin-bottom: 5px;
        font-size: 1em;
        font-weight: bold;
      }
      .flip-card-front .question-text {
        font-size: 1em;
        color: #333;
        margin-top: 5px;
        font-weight: bold;
      }

      /* --- Theme Card (Right Side) --- */
      .theme-card {
        width: 90%;
        max-width: 450px;
        background: #f5f5f5;
        border-radius: 10px;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        padding: 20px;
        margin-top: 20px;
        position: relative;
      }
      .theme-card h2,
      .theme-card h3 {
        text-align: center;
        font-family: "Helvetica", sans-serif;
        text-transform: uppercase;
        letter-spacing: 2px;
        font-weight: normal;
        margin-top: 0;
      }
      .theme-card h3 {
        letter-spacing: 1px;
        border-bottom: 1px solid #ccc;
        padding-bottom: 5px;
        margin-bottom: 10px;
      }

      /* THEME TITLE & MYSTERY editable areas */
      .editable-title {
        width: 100%;
        min-height: 30px;
        padding: 8px;
        font-size: 1.1em;
        font-weight: bold;
        border-bottom: 2px solid #ccc;
        text-align: center;
        outline: none;
        cursor: text;
        margin-bottom: 15px;
      }
      .editable-title:empty::before {
        content: "Type here...";
        color: #999;
      }

      /* Power & Weakness Tags list styling */
      .power-tags,
      .weakness-tags {
        margin-top: 15px;
      }
      .power-tag-line,
      .weakness-tag-line {
        display: flex;
        align-items: center;
        margin: 5px 0;
        position: relative;
        min-height: 24px;
        border-bottom: 1px dotted #ccc;
      }
      .tag-letter {
        width: 20px;
        font-weight: bold;
        text-align: left;
        margin-right: 10px;
      }
      .tag-text {
        flex: 1;
        color: #555;
        outline: none;
        cursor: text;
      }
      .tag-text:empty::before {
        content: "Click to edit...";
        color: #999;
      }
      .clear-slot {
        position: absolute;
        right: 5px;
        top: 50%;
        transform: translateY(-50%);
        cursor: pointer;
        color: red;
        font-weight: bold;
      }

      /* --- Custom Tooltip --- */
      #tooltip {
        position: fixed;
        background: rgba(50, 50, 50, 0.9);
        color: #fff;
        padding: 6px 10px;
        border-radius: 5px;
        pointer-events: none;
        opacity: 0;
        transition: opacity 0.1s;
        z-index: 9999;
        font-size: 0.85em;
        max-width: 300px;
      }
    </style>
  </head>
  <body>
    <div id="tooltip"></div>

    <div class="split-container">
      <!-- LEFT PANEL: Flip Cards for Power & Weakness arranged horizontally -->
      <div class="left-panel">
        <h2 style="width: 100%">POWER TAG QUESTIONS</h2>
        <p>
          Answer the question A; then choose two more questions to answer.
          Answer each question with a single description no more than a few
          words long. In your answer, you should describe something that will be
          useful to your character during the game. Each answer becomes a power
          tag. Write it on your theme card under POWER TAGS along with the letter
          of the question.
        </p>
        <!-- POWER CARD A -->
        <div class="flip-card" id="cardA">
          <div class="flip-card-inner">
            <div class="flip-card-front" id="frontA">
              <div
                class="draggable-letter"
                draggable="true"
                data-letter="A"
                data-question="What Mythos power allows you to respond differently to every situation?"
              >
                <span>A</span>
              </div>
              <div class="question-text">
                What Mythos power allows you to respond differently to every situation?
              </div>
            </div>
            <div class="flip-card-back">
              <div class="answer-bottom">
                <div
                  class="answer-block"
                  draggable="true"
                  data-letter="A"
                  data-question="What Mythos power allows you to respond differently to every situation?"
                  data-answer="cast a magic spell"
                >
                  cast a magic spell
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- POWER CARD B -->
        <div class="flip-card" id="cardB">
          <div class="flip-card-inner">
            <div class="flip-card-front" id="frontB">
              <div
                class="draggable-letter"
                draggable="true"
                data-letter="B"
                data-question="What narrow group of effects within your Mythos’ domain have you mastered?"
              >
                <span>B</span>
              </div>
              <div class="question-text">
                What narrow group of effects within your Mythos’ domain have you mastered?
              </div>
            </div>
            <div class="flip-card-back">
              <div class="answer-bottom">
                <div
                  class="answer-block"
                  draggable="true"
                  data-letter="B"
                  data-question="What narrow group of effects within your Mythos’ domain have you mastered?"
                  data-answer="transportation spells"
                >
                  transportation spells
                </div>
              </div>
            </div>
          </div>
        </div>

        <h2 style="width: 100%">WEAKNESS TAG QUESTIONS</h2>
        <p>
          Choose one question to answer. Answer it with a single description no
          more than a few words long. In your answer, you should describe
          something that will impede your character’s actions during the game.
          Your answer becomes a weakness tag. Write it on your theme card under
          WEAKNESS TAGS along with the letter of the question.
        </p>

        <!-- WEAKNESS CARD A -->
        <div class="flip-card" id="cardWA">
          <div class="flip-card-inner">
            <div class="flip-card-front" id="frontWA">
              <div
                class="draggable-letter"
                draggable="true"
                data-letter="A"
                data-question="What are your powers of adaptivity dependent on?"
              >
                <span>A</span>
              </div>
              <div class="question-text">
                What are your powers of adaptivity dependent on?
              </div>
            </div>
            <div class="flip-card-back">
              <div class="answer-bottom">
                <div
                  class="answer-block"
                  draggable="true"
                  data-letter="A"
                  data-question="What are your powers of adaptivity dependent on?"
                  data-answer="only works with a magic wand"
                >
                  only works with a magic wand
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- WEAKNESS CARD B -->
        <div class="flip-card" id="cardWB">
          <div class="flip-card-inner">
            <div class="flip-card-front" id="frontWB">
              <div
                class="draggable-letter"
                draggable="true"
                data-letter="B"
                data-question="What results are harder for your Mythos to achieve?"
              >
                <span>B</span>
              </div>
              <div class="question-text">
                What results are harder for your Mythos to achieve?
              </div>
            </div>
            <div class="flip-card-back">
              <div class="answer-bottom">
                <div
                  class="answer-block"
                  draggable="true"
                  data-letter="B"
                  data-question="What results are harder for your Mythos to achieve?"
                  data-answer="dark magic is forbidden"
                >
                  dark magic is forbidden
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- RIGHT PANEL: Theme Card with Editable THEME TITLE, MYSTERY, Power & Weakness Tag Slots -->
      <div class="right-panel">
        <div class="theme-card">
          <h3>THEME TITLE</h3>
          <div id="themeTitle" class="editable-title" contenteditable="true">Type here...</div>

          <h3>MYSTERY</h3>
          <div id="mystery" class="editable-title" contenteditable="true">Type here...</div>

          <h3>Power Tags</h3>
          <div class="power-tags">
            <div class="power-tag-line" id="slot1" data-question="">
              <div class="tag-letter" id="letter1"></div>
              <div class="tag-text" id="text1" contenteditable="true"></div>
              <span class="clear-slot" onclick="clearSlot(this.parentElement)">X</span>
            </div>
            <div class="power-tag-line" id="slot2" data-question="">
              <div class="tag-letter" id="letter2"></div>
              <div class="tag-text" id="text2" contenteditable="true"></div>
              <span class="clear-slot" onclick="clearSlot(this.parentElement)">X</span>
            </div>
            <div class="power-tag-line" id="slot3" data-question="">
              <div class="tag-letter" id="letter3"></div>
              <div class="tag-text" id="text3" contenteditable="true"></div>
              <span class="clear-slot" onclick="clearSlot(this.parentElement)">X</span>
            </div>
            <div class="power-tag-line" id="slot4" data-question="">
              <div class="tag-letter" id="letter4"></div>
              <div class="tag-text" id="text4" contenteditable="true"></div>
              <span class="clear-slot" onclick="clearSlot(this.parentElement)">X</span>
            </div>
            <div class="power-tag-line" id="slot5" data-question="">
              <div class="tag-letter" id="letter5"></div>
              <div class="tag-text" id="text5" contenteditable="true"></div>
              <span class="clear-slot" onclick="clearSlot(this.parentElement)">X</span>
            </div>
            <div class="power-tag-line" id="slot6" data-question="">
              <div class="tag-letter" id="letter6"></div>
              <div class="tag-text" id="text6" contenteditable="true"></div>
              <span class="clear-slot" onclick="clearSlot(this.parentElement)">X</span>
            </div>
            <div class="power-tag-line" id="slot7" data-question="">
              <div class="tag-letter" id="letter7"></div>
              <div class="tag-text" id="text7" contenteditable="true"></div>
              <span class="clear-slot" onclick="clearSlot(this.parentElement)">X</span>
            </div>
          </div>

          <h3>Weakness Tags</h3>
          <div class="weakness-tags">
            <div class="weakness-tag-line" id="wslot1" data-question="">
              <div class="tag-letter" id="wletter1"></div>
              <div class="tag-text" id="wtext1" contenteditable="true"></div>
              <span class="clear-slot" onclick="clearWeaknessSlot(this.parentElement)">X</span>
            </div>
            <div class="weakness-tag-line" id="wslot2" data-question="">
              <div class="tag-letter" id="wletter2"></div>
              <div class="tag-text" id="wtext2" contenteditable="true"></div>
              <span class="clear-slot" onclick="clearWeaknessSlot(this.parentElement)">X</span>
            </div>
            <div class="weakness-tag-line" id="wslot3" data-question="">
              <div class="tag-letter" id="wletter3"></div>
              <div class="tag-text" id="wtext3" contenteditable="true"></div>
              <span class="clear-slot" onclick="clearWeaknessSlot(this.parentElement)">X</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script>
      // VERTICAL FLIP
      document.getElementById("cardA").addEventListener("click", function () {
        this.querySelector(".flip-card-inner").classList.toggle("flipped");
      });
      document.getElementById("cardB").addEventListener("click", function () {
        this.querySelector(".flip-card-inner").classList.toggle("flipped");
      });
      document.getElementById("cardWA").addEventListener("click", function () {
        this.querySelector(".flip-card-inner").classList.toggle("flipped");
      });
      document.getElementById("cardWB").addEventListener("click", function () {
        this.querySelector(".flip-card-inner").classList.toggle("flipped");
      });

      // DRAG & DROP for Front Letters (Power & Weakness)
      const draggableLetterA = document.querySelector("#frontA .draggable-letter");
      const draggableLetterB = document.querySelector("#frontB .draggable-letter");
      const draggableLetterWA = document.querySelector("#frontWA .draggable-letter");
      const draggableLetterWB = document.querySelector("#frontWB .draggable-letter");

      [
        draggableLetterA,
        draggableLetterB,
        draggableLetterWA,
        draggableLetterWB,
      ].forEach((letterEl) => {
        letterEl.addEventListener("dragstart", function (e) {
          e.dataTransfer.setData("letter", this.dataset.letter);
          e.dataTransfer.setData("question", this.dataset.question);
          e.dataTransfer.setData("answer", "");
          e.dataTransfer.setDragImage(
            this,
            this.offsetWidth / 2,
            this.offsetHeight / 2
          );
        });
      });

      // DRAG & DROP for Answer Blocks on Back (Power & Weakness)
      const answerBlocks = document.querySelectorAll(".answer-block");
      answerBlocks.forEach((block) => {
        block.addEventListener("dragstart", (e) => {
          e.dataTransfer.setData("letter", e.target.dataset.letter);
          e.dataTransfer.setData("question", e.target.dataset.question);
          e.dataTransfer.setData("answer", e.target.dataset.answer);
        });
      });

      // DRAG & DROP for Right Panel (Power Tag Slots)
      const maxPowerSlots = 7;
      for (let i = 1; i <= maxPowerSlots; i++) {
        const slot = document.getElementById(`slot${i}`);
        const letterDiv = document.getElementById(`letter${i}`);
        const textDiv = document.getElementById(`text${i}`);

        slot.addEventListener("dragover", (e) => {
          e.preventDefault();
        });
        slot.addEventListener("drop", (e) => {
          e.preventDefault();
          const letter = e.dataTransfer.getData("letter");
          const question = e.dataTransfer.getData("question");
          const answer = e.dataTransfer.getData("answer");
          letterDiv.textContent = letter;
          textDiv.textContent = answer;
          slot.dataset.question = question;
        });
      }

      // DRAG & DROP for Right Panel (Weakness Tag Slots)
      const maxWeaknessSlots = 3;
      for (let i = 1; i <= maxWeaknessSlots; i++) {
        const wslot = document.getElementById(`wslot${i}`);
        const wletterDiv = document.getElementById(`wletter${i}`);
        const wtextDiv = document.getElementById(`wtext${i}`);

        wslot.addEventListener("dragover", (e) => {
          e.preventDefault();
        });
        wslot.addEventListener("drop", (e) => {
          e.preventDefault();
          const letter = e.dataTransfer.getData("letter");
          const question = e.dataTransfer.getData("question");
          const answer = e.dataTransfer.getData("answer");
          wletterDiv.textContent = letter;
          wtextDiv.textContent = answer;
          wslot.dataset.question = question;
        });
      }

      // CLEAR SLOT FUNCTION for Power Tags
      function clearSlot(slotElement) {
        const letterDiv = slotElement.querySelector(".tag-letter");
        const textDiv = slotElement.querySelector(".tag-text");
        letterDiv.textContent = "";
        textDiv.textContent = "";
        slotElement.dataset.question = "";
      }

      // CLEAR SLOT FUNCTION for Weakness Tags
      function clearWeaknessSlot(slotElement) {
        const letterDiv = slotElement.querySelector(".tag-letter");
        const textDiv = slotElement.querySelector(".tag-text");
        letterDiv.textContent = "";
        textDiv.textContent = "";
        slotElement.dataset.question = "";
      }

      // CUSTOM TOOLTIP
      const tooltip = document.getElementById("tooltip");
      function showTooltip(text) {
        tooltip.textContent = text;
        tooltip.style.opacity = "1";
      }
      function hideTooltip() {
        tooltip.style.opacity = "0";
      }
      document.addEventListener("mousemove", (e) => {
        if (tooltip.style.opacity === "1") {
          let x = e.clientX + 15;
          let y = e.clientY + 15;
          if (x + tooltip.offsetWidth > window.innerWidth) {
            x -= tooltip.offsetWidth + 30;
          }
          if (y + tooltip.offsetHeight > window.innerHeight) {
            y -= tooltip.offsetHeight + 30;
          }
          tooltip.style.top = y + "px";
          tooltip.style.left = x + "px";
        }
      });
      function handleMouseEnter() {
        const question = this.dataset.question;
        if (question) {
          showTooltip(question);
        }
      }
      function handleMouseLeave() {
        hideTooltip();
      }

      // For all answer blocks
      answerBlocks.forEach((block) => {
        block.addEventListener("mouseenter", function () {
          const question = this.dataset.question;
          if (question) showTooltip(question);
        });
        block.addEventListener("mouseleave", handleMouseLeave);
      });

      // For all power tag slots
      for (let i = 1; i <= maxPowerSlots; i++) {
        const slot = document.getElementById(`slot${i}`);
        slot.addEventListener("mouseenter", handleMouseEnter);
        slot.addEventListener("mouseleave", handleMouseLeave);
      }
      // For all weakness tag slots
      for (let i = 1; i <= maxWeaknessSlots; i++) {
        const wslot = document.getElementById(`wslot${i}`);
        wslot.addEventListener("mouseenter", handleMouseEnter);
        wslot.addEventListener("mouseleave", handleMouseLeave);
      }

      // (Optional) Save THEME TITLE and MYSTERY in localStorage
      document.addEventListener("DOMContentLoaded", function () {
        const themeTitleDiv = document.getElementById("themeTitle");
        const mysteryDiv = document.getElementById("mystery");

        // Remove placeholder text on focus and restore if left empty
        [themeTitleDiv, mysteryDiv].forEach(div => {
          div.addEventListener("focus", function () {
            if (this.textContent.trim() === "Type here...") {
              this.textContent = "";
            }
          });
          div.addEventListener("blur", function () {
            if (this.textContent.trim() === "") {
              this.textContent = "Type here...";
            }
          });
        });

        // Load saved values
        themeTitleDiv.textContent = localStorage.getItem("themeTitle") || "Type here...";
        mysteryDiv.textContent = localStorage.getItem("mystery") || "Type here...";

        // Save on input change
        function saveToLocalStorage() {
          localStorage.setItem("themeTitle", themeTitleDiv.textContent.trim());
          localStorage.setItem("mystery", mysteryDiv.textContent.trim());
        }

        themeTitleDiv.addEventListener("input", saveToLocalStorage);
        mysteryDiv.addEventListener("input", saveToLocalStorage);
      });

    </script>
  </body>
</html>
